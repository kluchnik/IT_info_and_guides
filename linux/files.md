# Параметры файлов

## inode
Вся эта информация (за исключением имени файла и его содержимого) сохраняется в рамках структуры **inode**.  
Таблица структур inode содержит информацию о всех структурах inode и создается в момент создания файловой системы (с помощью утилиты mkfs).  
```
# df -i
Файловая система  Iнодов IИспользовано IСвободно IИспользовано% Cмонтировано в
/dev/mapper/VolGroup00-LogVol00
                 4947968        115326   4832642             3% /
/dev/hda1          26104            45     26059             1% /boot
tmpfs              64417             1     64416             1% /dev/shm
/dev/sda1         262144          2207    259937             1% /home/project42
/dev/sdb1          74400          5519     68881             8% /home/project33
/dev/sdb5              0             0         0              -  /home/sales
/dev/sdb6         100744            11    100733             1% /home/research
```
В приведенном выше примере вывода команды df -i вы можете обнаружить процентные показатели использования структур inode для некоторых смонтированных файловых систем. Данный показатель не приводится для устройства /dev/sdb5 ввиду того, что на этом устройстве используется файловая система fat.  
#### Идентификатор структуры inode
Каждая структура inode имеет уникальный идентификатор (идентификатор структуры inode). Вы можете увидеть идентификаторы структур inode в выводе команды ls -li.  
```
$: touch file1
$: touch file2
$: touch file3
$: ls -li
итого 12
817266 -rw-rw-r--  1 paul paul 0 фев  5 15:38 file1
817267 -rw-rw-r--  1 paul paul 0 фев  5 15:38 file2
817268 -rw-rw-r--  1 paul paul 0 фев  5 15:38 file3
```
Три этих файла создавались последовательно, причем им соответствуют три различные структуры inode (идентификаторы которых выводятся в первом столбце).  

## Директории
Директория является особым видом файла, который содержит таблицу соответствия между именами файлов и структурами inode.  
```
$: ls -ali
817262 drwxrwxr-x   2 paul paul  4096 фев  5 15:42 .
800768 drwx------  16 paul paul  4096 фев  5 15:42 ..
817266 -rw-rw-r--   1 paul paul     0 фев  5 15:38 file1
817270 -rw-rw-r--   1 paul paul   147 фев  5 15:42 file2
817268 -rw-rw-r--   1 paul paul     0 фев  5 15:38 file3
```
(.) - соответствует текущей директории  
(..) - соответствует родительской директории  

## Пользователь и группа, владеющие файлом

Пользователи и группы пользователей в рамках системы могут быть описаны в локальных файлах /etc/passwd и /etc/group или объявлены на уровне сервера NIS, LDAP или домена Samba. Эти пользователи и группы пользователей могут владеть файлами. На самом деле каждым файлом владеет как пользователь, так и группа пользователей.

Форма доступа к файлу:
```
X XXX XXX XXX XXXXXXX XXXXXXX
1  2   3   4     5       6

1 - тип файла
2 - права доступа к файлу для владельца
3 - права доступа к файлу для группы пользователей
4 - права доступа к файлу для всех остальных
5 - пользователь файла
6 - группа пользователей для файла
```

#### Утилита chgrp

Вы можете изменить имя группы пользователей, владеющей файлом, с помощью утилиты chgrp.
```
chgrp snooker file
```

#### Утилита chown

Имя пользователя, владеющего файлом, может быть изменено с помощью утилиты chown.

```
chown paul file
```

Вы также можете использовать утилиту chown для одновременного изменения имен пользователя и группы пользователей, владеющих файлом.

```
chown root:project file 
```

## Список специальных типов файлов

```
========================================
|Первый символ | Тип файла             |
========================================
| -            | Обычный файл          |
| d            | Директория            |
| l            | Символьная ссылка     |
| p            | Именованный канал     |
| b            | Блочное устройство    |
| c            | Символьное устройство |
| s            | Сокет                 |
========================================
```

## Права доступа

```
============================================================================================
| Право доступа  | К файлу                          | К директории                         |
============================================================================================
| r (чтение)     | Чтение содержимого файла (cat)   | Чтение содержимого директории (ls)   |
| w (запись)     | Изменение содержимого файла (vi) | Создание файлов в директории (touch) |
| x (исполнение) | Исполнение файла                 | Вход в директорию (cd)               |
============================================================================================
```
Девять символов, следующих после символа типа файла, отображают права доступа к файлу, разделенные на три триплета.

```
===================================================================================
| Позиция | Символы | Назначение                                                  |
===================================================================================
| 1       | -       | Указание на то, что это обычный файл.                       |
| 2-4     | rwx     | Права доступа для пользователя, владеющего файлом           |
| 5-7     | r-x     | Права доступа для пользователей из группы, владеющей файлом |
| 8-10    | r--     | Права доступа для остальных пользователей                   |
===================================================================================
```

#### Установка прав доступа (chmod)

Права доступа могут быть изменены с помощью утилиты chmod.
```
$: chmod <Права> <Файл>
```
Права доступа в текством представлении
```
u[+|-][r|w|x] - изменить права для пользователей владейца файла
g[+|-][r|w|x] - изменить права для группы пользователей
o[+|-][r|w|x] - изменить права для пользователей не являющихся владельцами и не входящих в группу
a[+|-][r|w|x] - изменить права для всех сущностей (u, g, o)
[+|-][r|w|x] - изменить права для всех сущностей (u, g, o)
u=[r|w|x] - явно задать права для пользователей владейца файла
g=[r|w|x] - явно задать права для группы пользователей
o=[r|w|x] - явно задать права для пользователей не являющихся владельцами и не входящих в группу
a=[r|w|x] - явно задать права для всех сущностей (u, g, o)
```

Права доступа в восьмеричном представлении
```
===========================================
| Двоичное      | Восьмеричное  | Права   |
| представление | представление | доступа |
===========================================
| 000           | 0             | ---     |
| 001           | 1             | --x     |
| 010           | 2             | -w-     |
| 011           | 3             | -wx     |
| 100           | 4             | r--     |
| 101           | 5             | r-x     |
| 110           | 6             | rw-     |
| 111           | 7             | rwx     |
===========================================
```

## Дополнительные параметры

#### sticky
**sticky** - для директории с целью предотвращения удаления файлов пользователями, которые не являются их непосредственными владельцами.
```
#: mkdir /testdir
#: ls -ld /testdir
drwxr-xr-x  2 root root 4096 фев  7 17:38 /testdir
#: chmod +t /testdir/
#: ls -ld /testdir
drwxr-xr-t  2 root root 4096 фев  7 17:38 /testdir
```

#### setgid
**setgid** - может устанавливаться для директорий в тех случаях, когда необходимо, чтобы в качестве группы пользователей, владеющей всеми файлами в директории, использовалась группа пользователей, владеющая директорией.
```
#: mkdir /testdir
#: groupadd proj
#: chown root:proj /testdir/
#: chmod 2775 /testdir/
#: touch /testdir/fromroot.txt
#: ls -ld /testdir/
drwxrwsr-x  2 root proj 4096 фев  7 17:45 /testdir/
#: ls -l /testdir/
-rw-r--r--  1 root proj 0 фев  7 17:45 fromroot.txt
```
Как показано в данном примере, несмотря на то, что пользователь root не состоит в группе proj, файлы, созданные пользователем root в директории /testdir, будут принадлежать группе пользователей proj ввиду установки бита setgid.  

#### setgid и setuid
**setgid** и **setuid** для обычных файлов - позволяют запускать исполняемый файл с правами пользователя, владеющего файлом, а не с правами пользователя, инициировавшего запуск файла.  
При запуске программы passwd вы инициируете ее исполнение с правами пользователя root.  
```
#: ls -l /etc/shadow
-r--------  1 root root 1260 янв 21 07:49 /etc/shadow
#: ls -l /usr/bin/passwd 
-r-s--x--x  1 root root 21200 июн 17  2005 /usr/bin/passwd
```
Для бинарного файла sudo бит setuid устанавливается по умолчанию, поэтому любой пользователь может инициировать его исполнение с эффективным идентификатором пользователя root.  
```
$: ls -l $(which sudo)
---s--x--x. 1 root root 123832 окт  7  2013 /usr/bin/sudo
```

## Ссылки

#### Жесткие ссылки
При создании жествкой ссылки в файл директории добавляется дополнительная запись, новое имя файла ставится в соответствие существующей структуре inode.
```
$: ln file2 hardlink_to_file2
$: ls -li
817266 -rw-rw-r--  1 paul paul   0 фев  5 15:38 file1
817270 -rw-rw-r--  2 paul paul 147 фев  5 15:42 file2
817268 -rw-rw-r--  1 paul paul   0 фев  5 15:38 file3
817270 -rw-rw-r--  2 paul paul 147 фев  5 15:42 hardlink_to_file2
```
Оба файла будут использовать одну и ту же структуру inode, поэтому они в любом случае будут иметь одни и те же права доступа, а также одного и того же владельца. Оба этих файла также будут иметь одно и то же содержимое. На самом деле, оба этих файла будут идентичными и это означает, что вы можете безопасно удалить оригинальный файл и это никак не повлияет на существование файла, являющегося жесткой ссылкой. Структура inode содержит счетчик, использующийся для подсчета количества жестких ссылок на нее. В момент, когда значение счетчика уменьшается до нуля, содержимое структуры inode очищается.  

#### Символьные ссылки (мягкие ссылки)
Символьные ссылки (иногда называемые мягкими ссылками) не указывают на структуры inode, а являются соответствиями между именами файлов. Символьная ссылка имеет собственную структуру inode.  
```
$: ln -s file2 symlink_to_file2
$: ls -li
817273 -rw-rw-r--  1 paul paul  13 фев  5 17:06 file1
817270 -rw-rw-r--  2 paul paul 147 фев  5 17:04 file2
817268 -rw-rw-r--  1 paul paul   0 фев  5 15:38 file3
817270 -rw-rw-r--  2 paul paul 147 фев  5 17:04 hardlink_to_file2
817267 lrwxrwxrwx  1 paul paul   5 фев  5 16:55 symlink_to_file2 -> file2
```
Права доступа к символьной ссылке не имеют значения, так как в итоге будут учитываться права доступа к целевому файлу. Жесткие ссылки ограничены своими разделами дисков (ввиду того, что они указывают на структуры inode), в то время, как символьные ссылки могут указывать на какие угодно файлы (из других файловых систем, даже сетевых).  
